

* docker ps | grep "agent-app-ui" | awk -F' ' '{print $1}' | xargs docker logs -f

docker exec -it agent-app-api alembic -c db/alembic.ini revision --autogenerate -m "add dc contract db"
docker exec -it agent-app-api alembic -c db/alembic.ini upgrade head

* 사용자가 챗봇을 쓴다고 했을 때 처음에는 의도를 분석해서 단순 질의인지를 tool을 써야 하는지 등을 판단해야함.
intent 분류하고, 그에 맞춰서 필요한 agent 실행 시키기
대화의 연결을 감안하여 이어서 수행할수 있을지도 확인해야함
예를 들어 고객에 대한 디테일한 정보를 얻은 뒤에 그걸 활용

지금은 intent를 3개로 봐서
- DB를 기반으로 하는 고객 정보 제공
- simulator 계산 값 제공
- 정책 Q&A

일단 context를 json으로 가지고 있게 하고, 거기에 simulation type을 가지고 있다면, 그에 따라서 분기하는 방식
RAG를 쓴다면 그 결과도 이후 질문에 RAG로 활용 가능한지는 따져봐야함


Q: *** 고객은 연금 개시가 가능해?
Needs
 - 고객 정보 DB
    - 이름
    - 나이
    - 수령연차(RCVE_ODYR: Receive Order of Year) -> 이건 개시일같은 날짜를 주고 계산 필요할수 있음
    - 계좌 평가액 (ACNT_EVLU_AMT: Account Evaluation Amount) -> 이것도 상품 구분에 따라서 여러가지 
    - (필요) 계좌 구분
    - 계약이랑 연결
 - 수령 조건 Knowledge

insert into kis_customers (customer_id, customer_name, brth_dt, age_band) values
(1111, '김한투', '19650302', 60)
,(2222, '이미래', '19550811', 70)
,(3333, '최삼성', '19711124', 50);


insert into kis_accounts (account_id, customer_id, acnt_type, prd_type_cd, acnt_bgn_dt, acnt_evlu_amt)
values
 (41500000, 2222, 'CMA', 21, '20001122', 50000000)

,(41598765, 1111, 'CMA', 21, '19991211', 103335918)
,(41598765, 1111, '연금저축', 22, '20140714', 67852849)
,(41598765, 1111, 'IRP', 29, '20121215', 733603018)
,(41598765, 1111, 'ISA', 01, '20210319', 107360026)
,(21500146000110, 1111, 'DC', 29, '20210630', 241155140);

{
    'ctrt_no': '계약번호',
    'odtp_name': '근무처명',
    'etco_dt': '입사일자',
    'midl_excc_dt': '중간정산일자',
    'sst_join_dt': '제도가입일자',
    'almt_pymt_prca': '부담금납입원금',
    'utlz_pfls_amt': '운용손익금액',
    'evlu_acca_smtl_amt': '평가적립금합계금액'
}

-- pgvector 확장
CREATE EXTENSION IF NOT EXISTS vector;

-- 핵심: text → vector 암시적 캐스트 (문자열을 자동으로 vector로 인식)
CREATE CAST (text AS vector) WITH INOUT AS IMPLICIT;

-- (선택) varchar → vector도 함께 허용하고 싶으면
CREATE CAST (varchar AS vector) WITH INOUT AS IMPLICIT;



"csno":"고객번호",
"cust_name":"고객명",
"brdt":"생년월일",
"tot_asst_amt":"총자산금액",
"cust_ivst_icln_grad_cd":"고객투자성향등급",
"cano":"종합계좌번호",
"acnt_prdt_cd":"계좌상품코드",
"acnt_type":"계좌구분",
"acnt_open_dt":"계좌개설일자",
"expd_dt":"만기일자",
"etco_dt":"입사일자",
"rtmt_dt":"퇴직일자",
"midl_excc_dt":"중간정산일자",
"evlu_amt":"평가금액",
"copt_year_pymt_amt":"당해년도납입금액",
"other_txtn_ecls_amt":"그외과세제외금액",
"rtmt_incm_amt":"퇴직소득금액",
"icdd_amt":"소득공제금액",
"user_almt_amt":"사용자부담금",
"sbsr_almt_amt":"가입자부담금",
"utlz_erng_amt":"운용수익금액",
"dfr_rtmt_taxa":"이연퇴직소득세",